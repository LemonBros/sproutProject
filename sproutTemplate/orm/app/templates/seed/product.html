{% extends "base.html" %}
{% block content %}
<script>
function addItem(){
    const userAction = async () => {
        var seed_id = {{ product.id }};
        var qtyElt = document.querySelectorAll('[aria-label="quantity"]')[0];
        var quantity = parseInt(qtyElt.options[qtyElt.selectedIndex].text, 10); 
        if(quantity > 0) {
            const response = await fetch(`{{url_for('add_to_cart')}}?seed_id=${seed_id}&quantity=${quantity}`, {
                //const response = await fetch(`{{url_for('add_to_cart')}}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const myJson = await response.json(); //extract JSON from the http response
            // do something with myJson
            document.getElementById("demo").innerHTML = myJson["reply"];
        }
    }
    userAction()
}
    </script>
    <div class="container-xxl">
        <div class="row justify-content-center">
            <h2>{{ product.name }}</h2>
            <div class="col-5"><img src="{{url_for('static', filename=product.imagePath)}}" alt="product" style="width:80%; height: 80%;"></div> 
            <div class="col-5"><b>Description:</b><br>
                {{ seed_info[product.name] }}
            </div>  
        </div>
        <div class="row justify-content-center">
            <div class="col-5">   
            </div>  
            <div class="col-5">
                <table class="table table-striped table-secondary table-hover">
                    <thead>
                      <tr>
                        <th scope="col">Item</th>
                        <th scope="col">Price</th>
                        <th scope="col">Quantity</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th scope="row">1 Package (10 seeds)</th>
                        <td>$9.99</td>
                        <td><select class="form-select" aria-label="quantity">
                            <option selected value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="3">4</option>
                            <option value="3">5</option>
                            <option value="3">6</option>
                            <option value="3">7</option>
                            <option value="3">8</option>
                            <option value="3">9</option>
                          </select>
                        </td>
                      </tr>
                     
                     
                    </tbody>
                  </table>
                  {%if current_user.is_authenticated %}
                  <button type="submit" onclick="addItem()" class="btn btn-secondary btn-lg">Add to Cart!</button>
                  {% else %}
                  <a href="{{ url_for('login') }}">Login to Purchase</a> 
                  {% endif %}
                  <p id="demo"></p>
                  
            </div>  
    </div>
    </div>
{% endblock %}

